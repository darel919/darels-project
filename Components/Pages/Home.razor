@inject NavigationManager Navigation
@page "/"
@rendermode InteractiveServer
<PageTitle>Home</PageTitle>

<h1>Welcome to darel's Video Project</h1>

@if(fetchedVideos != null) {
    @foreach (var video in fetchedVideos) {
    <div class="videoPage">
       <a href="#" @onclick="() => NavigateToVideo(video.content_id)">
        <img loading="eager" src="@video.ytData.videoThumbnails[4].url" alt="Thumbnail"/>
        <h1>@video.ytData.title</h1>
        <h6>@video.created_at</h6>
        </a>
    </div>
}
} else {
    <h1>Loading content...</h1>
}


@code {
    private readonly HttpClient httpClient = new HttpClient();
    
    @* [Parameter] *@
    public List<FetchedData> fetchedVideos;

    public class Thumbnail {
        public string url { get; set; }
    }

    public class YTData {
        public string title { get; set; }
        public List<Thumbnail> videoThumbnails { get; set; }
    }

    public class FetchedData {
        public DateTime created_at { get; set; }
        public string content_id { get; set; }
        public string type_id { get; set; }
        public YTData ytData { get; set; }
    }


    protected override async Task OnParametersSetAsync() {
        await FetchData();
    }

    public async Task FetchData() {
        var apiUrl = $"http://10.10.10.10:328/dp?sortBy=desc";
        fetchedVideos = await httpClient.GetFromJsonAsync<List<FetchedData>>(apiUrl);
    }

    private void NavigateToVideo(string content_id) {
        Navigation.NavigateTo($"/watch?v={content_id}");
    }
}
